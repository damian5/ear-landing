---
const pathname = new URL(Astro.request.url).pathname;
const currentPath = pathname.slice(1);
---

<nav class="nav-header">
	<div class="container">
		<div class="nav-content">
			<div class="nav-logo">
				<a href="/">
					<img width="150px" src="/logo.svg" alt="Logo" /></a
				>
			</div>

			<!-- Hamburger Menu Button -->
			<button class="mobile-menu-toggle" aria-label="Toggle menu">
				<span></span>
				<span></span>
				<span></span>
			</button>

			<ul class="nav-links">
				<li>
					<a href="/" class={pathname === "/" ? "active" : ""}
						>Inicio</a
					>
				</li>
				<li>
					<a
						href="/features"
						class={pathname.startsWith("/features") ? "active" : ""}
						>Caracter√≠sticas</a
					>
				</li>
				<li>
					<a
						href="/about"
						class={pathname.startsWith("/about") ? "active" : ""}
						>Nosotros</a
					>
				</li>
				<li>
					<a
						href="/resources"
						class={pathname.startsWith("/resources")
							? "active"
							: ""}>Recursos</a
					>
				</li>
				<li>
					<a href="/#contacto" class="btn btn-primary btn-sm main-btn"
						>Contacto</a
					>
				</li>
			</ul>
		</div>
	</div>
</nav>

<style>
	/* ===== NAVIGATION HEADER ===== */
	.main-btn {
		color: var(--color-text-white) !important;
	}
	.nav-header {
		position: fixed;
		top: 0;
		left: 0;
		right: 0;
		background: rgba(255, 255, 255, 0.95); /* More opaque white */
		backdrop-filter: blur(10px);
		border-bottom: 1px solid rgba(0, 0, 0, 0.05); /* Lighter border */
		z-index: 1000;
		padding: var(--spacing-md) 0;
		box-shadow: var(--shadow-sm); /* Added shadow for separation */
	}

	.nav-content {
		display: flex;
		justify-content: space-between;
		align-items: center;
	}

	.nav-logo a {
		font-size: var(--font-size-xl);
		font-weight: 700;
		color: var(
			--color-accent-primary
		); /* Solid Green logo instead of gradient */
		text-decoration: none;
	}

	.nav-links {
		display: flex;
		gap: var(--spacing-xl);
		list-style: none;
		align-items: center;
	}

	.nav-links a {
		color: var(--color-text-black);
		text-decoration: none;
		transition: color var(--transition-fast);
		font-weight: 500;
	}

	.nav-links a:hover,
	.nav-links a.active {
		color: var(--color-accent-secondary);
	}

	/* Active nav link specific override */
	.nav-links a.active {
		font-weight: 600;
	}

	/* Mobile menu toggle button */
	.mobile-menu-toggle {
		display: none;
		flex-direction: column;
		gap: 5px;
		background: none;
		border: none;
		cursor: pointer;
		padding: 8px;
		z-index: 1001;
	}

	.mobile-menu-toggle span {
		width: 25px;
		height: 3px;
		background: var(--color-text-primary);
		border-radius: 3px;
		transition: all 0.3s ease;
	}
	.main-btn {
		color: var(--color-text-white);
	}

	/* Mobile menu styles */
	@media (max-width: 768px) {
		.mobile-menu-toggle {
			display: flex;
		}

		.nav-links {
			position: fixed;
			top: 0;
			right: -100%;
			height: 100vh;
			width: 70%;
			max-width: 300px;
			background: var(--color-bg-secondary);
			flex-direction: column;
			padding: 80px 30px 30px;
			gap: var(--spacing-lg);
			transition: right 0.3s ease;
			box-shadow: -5px 0 15px rgba(0, 0, 0, 0.3);
		}

		.main-btn {
			color: var(--color-text-white);
		}

		.nav-links.active {
			right: 0;
		}

		.nav-links li {
			width: 100%;
		}

		.nav-links a {
			display: block;
			padding: var(--spacing-sm) 0;
			font-size: var(--font-size-lg);
		}

		.nav-links .btn {
			width: 100%;
			text-align: center;
		}

		/* Hamburger animation when active */
		.mobile-menu-toggle.active span:nth-child(1) {
			transform: rotate(45deg) translate(5px, 5px);
		}

		.mobile-menu-toggle.active span:nth-child(2) {
			opacity: 0;
		}

		.mobile-menu-toggle.active span:nth-child(3) {
			transform: rotate(-45deg) translate(7px, -7px);
		}
	}
</style>

<script is:inline>
	function setupMobileMenu() {
		const mobileMenuToggle = document.querySelector(".mobile-menu-toggle");
		const navLinks = document.querySelector(".nav-links");

		if (!mobileMenuToggle || !navLinks) return;

		// Clone to remove old event listeners
		const newToggle = mobileMenuToggle.cloneNode(true);
		mobileMenuToggle.parentNode.replaceChild(newToggle, mobileMenuToggle);

		newToggle.addEventListener("click", (e) => {
			e.stopPropagation(); // Prevent immediate closing
			newToggle.classList.toggle("active");
			navLinks.classList.toggle("active");
		});

		// Close menu when clicking on a link
		const links = navLinks.querySelectorAll("a");
		links.forEach((link) => {
			link.addEventListener("click", () => {
				newToggle.classList.remove("active");
				navLinks.classList.remove("active");
			});
		});

		// Close menu when clicking outside
		document.addEventListener("click", (e) => {
			if (
				navLinks.classList.contains("active") &&
				!newToggle.contains(e.target) &&
				!navLinks.contains(e.target)
			) {
				newToggle.classList.remove("active");
				navLinks.classList.remove("active");
			}
		});
	}

	// Run on initial load
	setupMobileMenu();

	// Run on view transitions
	document.addEventListener("astro:page-load", setupMobileMenu);
</script>
